<div id="meeting-top-title">面談スケジュール調整</div>

<div id=content>
  <%= form_with(url: teacher_schedule_update_path(@teacher), method: :patch, local:true) do |f| %>
    <table class="table-bordered table-striped table-condensed meeting-table" style="width: 100%; margin-top: 20px;">
      <thead>
        <tr style="background: #FF9933; color: white;">
          <td>日付</td>
          <td>希望者</td>
          <td colspan="<%= @times_count.count %>">面談時間</td>
        </tr>
      </thead>

      <tbody>
        <% dates.sort.each do |date| %>
          <tr>
            <!-- 日付 -->
            <td rowspan="2" class="bg-info"><%= date.to_s(:date) %></td>
            <!-- 希望者 -->
            <td rowspan="2" class="bg-warning">
              <% @meetings_desired.each do |meeting| %>
                <% if meeting.date == date %>
                  <%= Child.find(meeting.child_id).full_name %><br>
                <% end %>
              <% end %>
            </td>
            <!-- 面談時間 -->
            <% @meeting_times_all.order(:time).each do |meeting_time| %>
                <% if meeting_time.time.to_date == date %>
                  <td class="bg-success"><%= meeting_time.time.to_s(:time) %></td>
                <% end %>
            <% end %>
          </tr>
          <tr>
            <!-- 面談者名 -->
            <% @meeting_times_all.each do |meeting_time| %>
              <% if meeting_time.time.to_date == date %>
                <%= fields_for "meeting_times[]", meeting_time do |af| %>
                <% unless meeting_time.name.present? %>
                  <td>
                    <% if meeting_select(@teacher, date, meeting_time).present? %>
                      <%= af.select :name, meeting_select(@teacher, date, meeting_time), include_blank: true, class: "form-control" %>
                    <% end %>
                  </td>
                <% else %>
                  <td>
                    <%= link_to "#{meeting_time.name}", teacher_schedule_update_path(@teacher, meeting_time_id: meeting_time.id), meeting_time_id: meeting_time.id, method: :patch %><br>
                    <% if meeting_select(@teacher, date, meeting_time).present? %>
                      <%= af.select :name, meeting_select(@teacher, date, meeting_time), include_blank: true, class: "form-control" %>
                    <% end %>
                  </td>
                <% end %>
                <% end %>
              <% end %>
            <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>
    <div id="submit-center">
      <%= f.submit "更新", class: "btn btn-success submit-width"%>
      <%= form_with(url: push_path, local:true) do |f| %>
        <%= f.submit "スケジュール決定送信", data: {confirm: "LINEグループに通知しますがよろしいですか？"}, class: "btn btn-primary submit-width"%>
      <% end %>
    </div>
  <% end %>
</div>
