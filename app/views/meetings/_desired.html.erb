<div class="modal-dialog" role="document">
  <div class="modal-content">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
      <div class="modal-title meeting-modal-title"><%= @user.name %>さんの面談希望日登録</div>
    </div>
    <div class="modal-body modal-desired">
      <%= form_with(url: user_desired_update_path(user_id: @user.id, child_id: @child.id), method: :patch, local:true) do |f| %>

        <%= f.label "面談希望日を選択してください" %>
        <%= f.select :status, options_from_collection_for_select(@teacher.meetings.where(child_id: @child.id), :id, :date), {}, id: "status", class: "form-control form-desired" %>
        <%= f.label "都合が悪い時間", style: "padding-top: 10px;" %><br>
        <%= f.select :nottime, options_for_select(@date_first), { include_hidden: false }, { multiple: true, class: "js-searchable form-control", id: "nottime" } %>

        <div id="desired-button">
          <button type="button" class="btn btn-default" data-dismiss="modal">閉じる</button>
          <%= f.submit "登録", class:"btn btn-primary" %>
        </div>
      <% end %>
    </div>
  </div>
</div>

<script>

  $('.js-searchable').select2({
    maximumSelectionLength: <%= @times_count.count - 1 %>,
    width: 300,
    placeholder: '都合が悪い時間を選択して下さい',
    language: {
      maximumSelected: (args) => 'すべての時間を選択してしまいます'
    },
    allowClear: true
  });

  $(function() {
    $('#status').change(function() {
      $.get({
        url: "#{select_date_path}",
        data: { status: $('#status').has('option:selected').val() }
      });
    });
  });

</script>
